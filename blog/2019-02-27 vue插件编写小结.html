<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>19-02-27 vue插件编写小结 | guidetheorient&#39;s blog</title>
    <meta name="description" content="guidetheorients blog">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.27863952.css" as="style"><link rel="preload" href="/blog/assets/js/app.07784aa4.js" as="script"><link rel="preload" href="/blog/assets/js/2.c1200efd.js" as="script"><link rel="preload" href="/blog/assets/js/17.8c2b56b4.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.3a7b220f.js"><link rel="prefetch" href="/blog/assets/js/11.3e73d5a8.js"><link rel="prefetch" href="/blog/assets/js/12.d7dfe4ee.js"><link rel="prefetch" href="/blog/assets/js/13.dad9285b.js"><link rel="prefetch" href="/blog/assets/js/14.bb3ef809.js"><link rel="prefetch" href="/blog/assets/js/15.26aead84.js"><link rel="prefetch" href="/blog/assets/js/16.abdcc1ca.js"><link rel="prefetch" href="/blog/assets/js/18.2f996232.js"><link rel="prefetch" href="/blog/assets/js/19.57a27d8e.js"><link rel="prefetch" href="/blog/assets/js/20.d350c752.js"><link rel="prefetch" href="/blog/assets/js/21.4601c4a8.js"><link rel="prefetch" href="/blog/assets/js/22.b4ceb77d.js"><link rel="prefetch" href="/blog/assets/js/23.b0a3c965.js"><link rel="prefetch" href="/blog/assets/js/24.61ff9cb3.js"><link rel="prefetch" href="/blog/assets/js/25.27cc9eae.js"><link rel="prefetch" href="/blog/assets/js/26.e7e9edc1.js"><link rel="prefetch" href="/blog/assets/js/27.c899df60.js"><link rel="prefetch" href="/blog/assets/js/28.b2b385cc.js"><link rel="prefetch" href="/blog/assets/js/29.f02fe8e6.js"><link rel="prefetch" href="/blog/assets/js/3.e024d095.js"><link rel="prefetch" href="/blog/assets/js/30.6be7fb62.js"><link rel="prefetch" href="/blog/assets/js/31.a185d491.js"><link rel="prefetch" href="/blog/assets/js/32.e66e9655.js"><link rel="prefetch" href="/blog/assets/js/33.ce2b576f.js"><link rel="prefetch" href="/blog/assets/js/34.1a39b0e8.js"><link rel="prefetch" href="/blog/assets/js/35.ae12a9aa.js"><link rel="prefetch" href="/blog/assets/js/36.e949c413.js"><link rel="prefetch" href="/blog/assets/js/37.370df086.js"><link rel="prefetch" href="/blog/assets/js/38.b8209320.js"><link rel="prefetch" href="/blog/assets/js/39.a710c350.js"><link rel="prefetch" href="/blog/assets/js/4.e0c6271b.js"><link rel="prefetch" href="/blog/assets/js/40.3d443225.js"><link rel="prefetch" href="/blog/assets/js/41.13a31490.js"><link rel="prefetch" href="/blog/assets/js/42.9212c90b.js"><link rel="prefetch" href="/blog/assets/js/43.fe269efc.js"><link rel="prefetch" href="/blog/assets/js/44.72495e31.js"><link rel="prefetch" href="/blog/assets/js/45.0e0075bc.js"><link rel="prefetch" href="/blog/assets/js/46.41b4a3b1.js"><link rel="prefetch" href="/blog/assets/js/47.9fe3c288.js"><link rel="prefetch" href="/blog/assets/js/48.8a35d4da.js"><link rel="prefetch" href="/blog/assets/js/49.34e75339.js"><link rel="prefetch" href="/blog/assets/js/5.eaff2270.js"><link rel="prefetch" href="/blog/assets/js/50.3c3599ad.js"><link rel="prefetch" href="/blog/assets/js/51.dcf810cf.js"><link rel="prefetch" href="/blog/assets/js/52.7686693f.js"><link rel="prefetch" href="/blog/assets/js/53.5d121b7b.js"><link rel="prefetch" href="/blog/assets/js/54.8e67ae1d.js"><link rel="prefetch" href="/blog/assets/js/55.52b11df8.js"><link rel="prefetch" href="/blog/assets/js/56.35cb1f97.js"><link rel="prefetch" href="/blog/assets/js/57.a5ce68db.js"><link rel="prefetch" href="/blog/assets/js/58.1578629a.js"><link rel="prefetch" href="/blog/assets/js/59.5fa52b94.js"><link rel="prefetch" href="/blog/assets/js/6.e3b4f500.js"><link rel="prefetch" href="/blog/assets/js/60.3b56f664.js"><link rel="prefetch" href="/blog/assets/js/61.dcd6bc74.js"><link rel="prefetch" href="/blog/assets/js/62.a5c3be46.js"><link rel="prefetch" href="/blog/assets/js/63.0260a90d.js"><link rel="prefetch" href="/blog/assets/js/64.2d91dc0a.js"><link rel="prefetch" href="/blog/assets/js/65.aa6cb1f4.js"><link rel="prefetch" href="/blog/assets/js/66.917856d3.js"><link rel="prefetch" href="/blog/assets/js/67.9a3747eb.js"><link rel="prefetch" href="/blog/assets/js/68.fea047fa.js"><link rel="prefetch" href="/blog/assets/js/69.939a3137.js"><link rel="prefetch" href="/blog/assets/js/7.b6791622.js"><link rel="prefetch" href="/blog/assets/js/70.f827108e.js"><link rel="prefetch" href="/blog/assets/js/71.e5fc8632.js"><link rel="prefetch" href="/blog/assets/js/72.5bc34333.js"><link rel="prefetch" href="/blog/assets/js/73.7cd68ac8.js"><link rel="prefetch" href="/blog/assets/js/74.791c31cd.js"><link rel="prefetch" href="/blog/assets/js/75.62ad0f0c.js"><link rel="prefetch" href="/blog/assets/js/76.9768b570.js"><link rel="prefetch" href="/blog/assets/js/77.3c42697a.js"><link rel="prefetch" href="/blog/assets/js/78.8c955780.js"><link rel="prefetch" href="/blog/assets/js/79.2f810987.js"><link rel="prefetch" href="/blog/assets/js/8.1e06d97d.js"><link rel="prefetch" href="/blog/assets/js/80.90f0b386.js"><link rel="prefetch" href="/blog/assets/js/81.5b1df5fd.js"><link rel="prefetch" href="/blog/assets/js/9.06767110.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.27863952.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">guidetheorient's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/guidetheorient/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github 
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">Home</a></div><div class="nav-item"><a href="https://github.com/guidetheorient/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github 
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计划</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>blog</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/blog/" class="sidebar-link">Introduction</a></li><li><a href="/blog/blog/blog选题.html" class="sidebar-link">博客选题</a></li><li><a href="/blog/blog/职业生涯.html" class="sidebar-link">职业生涯</a></li><li><a href="/blog/blog/2018-12-20 学习资源.html" class="sidebar-link">学习资源整理</a></li><li><a href="/blog/blog/2018-12-19 git撤销操作总结.html" class="sidebar-link">18-12-19 git撤销操作总结</a></li><li><a href="/blog/blog/2018-12-19 Vue使用小结.html" class="sidebar-link">18-12-19 Vue使用小结</a></li><li><a href="/blog/blog/2018-12-19 开发小结.html" class="sidebar-link">18-12-19 开发小结</a></li><li><a href="/blog/blog/2019-02-22 vue-cli2升级到webpack4.x.html" class="sidebar-link">19-02-22 vue-cli2升级至webpack4.x</a></li><li><a href="/blog/blog/2019-02-25 webpack splitchunks试验.html" class="sidebar-link">19-02-25 webpack splitchunks试验</a></li><li><a href="/blog/blog/2019-02-26 post请求的content-type.html" class="sidebar-link">19-02-26 post请求的content-type</a></li><li><a href="/blog/blog/2019-02-27 vue插件编写小结.html" class="active sidebar-link">19-02-27 vue插件编写小结</a></li><li><a href="/blog/blog/2019-02-28 了解FLIP动画.html" class="sidebar-link">19-02-28 了解FLIP动画</a></li><li><a href="/blog/blog/2019-03-06 eslint配置指南.html" class="sidebar-link">19-03-06 eslint配置指南</a></li><li><a href="/blog/blog/2019-04-07 requestAnimationFrame.html" class="sidebar-link">19-04-07 requestAnimationFrame</a></li><li><a href="/blog/blog/你不知道的Chrome调试技巧.html" class="sidebar-link">你不知道的Chrome调试技巧</a></li><li><a href="/blog/blog/如何使用Canvas制作出炫酷的网页背景特效.html" class="sidebar-link">如何使用Canvas制作出炫酷的网页背景特效</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>资源整理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ECMAScript 6 入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript高级程序设计</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node学习</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Pro Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS世界</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript设计模式与开发实践</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>图解HTTP</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="_19-02-27-vue插件编写小结"><a href="#_19-02-27-vue插件编写小结" aria-hidden="true" class="header-anchor">#</a> 19-02-27 vue插件编写小结</h1> <blockquote><p>参考<br>
1.<a href="https://alligator.io/vuejs/creating-custom-plugins/" target="_blank" rel="noopener noreferrer">Creating Custom Vue.js Plugins - Joshua Bemenderfer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
2.<a href="https://www.imys.net/20161216/vue-custom-directive-hook.html" target="_blank" rel="noopener noreferrer">正确使用Vue指令的钩子函数 - 王昱森<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <div class="tip custom-block"><p class="custom-block-title">TODO</p> <ol><li>还需参考优秀插件编写方式进行优化</li> <li>bug修复（忘了上次遇到什么问题了，尴尬，动画对其他操作的影响也要考虑下，正好下一篇写FLIP动画）</li> <li>测试假设一个页面有多个容器</li> <li>思考一下，其实有两个选项，是做组件型的插件还是指令型的插件呢？</li> <li>Vue.use(xx, {})的第二个对象是传给install方法的第二个参数，适合传入一些插件公用配置</li> <li>对于这种多图片使用的插件呢，绑定容器好呢，还是绑定单张好呢？性能？能不能获取到子图片</li> <li>img的key非常重要，不加的话，随机更新一个位置了</li> <li>vue-element-admin封装方式</li> <li>图片更新时，key是必要项吗，还是比较迷的，有key时，先bind，inserted等等，bind后面夹着一个unbind上一张图片的，没有key时则没有unbind好像问题不大？不过昨天测试时，图片更新后的动画好像有可能不再更新的图片上，与v-show有关系吗？我猜与img上的key或者父组件上的key有点关系？</li></ol></div> <div class="warning custom-block"><p class="custom-block-title">忠告</p> <p>如果想写关于刚实践过的东西的blog，最好当时就写。过了很久才动笔的话，就要重头看一遍，测试一下，很是费时间</p></div> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>本文基于vue-img-hover-zoom-in v-0.2.2，插件在实际项目中使用完全ok。不过，实现上还有修改的空间，后续文章会随插件版本继续更新</p></div> <p></p><div class="table-of-contents"><ul><li><a href="#需求">需求</a></li><li><a href="#实现">实现</a></li><li><a href="#指令的钩子函数">指令的钩子函数</a><ul><li><a href="#区别">区别</a></li></ul></li></ul></div><p></p> <p>在使用Vue一些优秀的插件时，就想自己动手实践一下。一直偷懒，不过，后来还是将项目中的一些通用部分做成了插件，减少了点耦合，增加了代码通用性。Vue向插件提供了<code>Vue</code>这个构造器，所以你几乎可以写出你想要的任何插件。从<a href="https://cn.vuejs.org/v2/guide/plugins.html" target="_blank" rel="noopener noreferrer">插件文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中便可感受一二，包括：</p> <blockquote><ul><li>添加全局方法或者属性</li> <li>添加全局资源：指令/过滤器/过渡等</li> <li>通过全局 mixin 方法添加一些组件选项</li> <li>添加 Vue 实例方法，通过把它们添加到 Vue.prototype 上实现</li> <li>一个库，提供自己的 API，同时提供上面提到的一个或多个功能</li></ul></blockquote> <h2 id="需求"><a href="#需求" aria-hidden="true" class="header-anchor">#</a> 需求</h2> <p><a href="https://github.com/guidetheorient/vue-img-hover-zoom-in" target="_blank" rel="noopener noreferrer">vue-img-hover-zoom-in<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是动手实践的第一个插件。功能如下：<br>
1.鼠标悬浮在特定图片上时，显示一个根据鼠标位置变化尺寸的放大图<br>
2.右键自定义菜单弹出时隐藏，菜单消失后，再显示</p> <p><img src="/blog/assets/img/vue-img-hover-zoom-in.b2170156.gif" alt=""></p> <p>之前将其写成通用组件时，代码分散，不利于维护。分成了四部分：</p> <ul><li>放大图组件</li> <li>耦合在父组件中的监听鼠标移入移出方法</li> <li>mixin提供鼠标移入移出方法的回调函数，还需处理能否显示的逻辑</li> <li>vuex中用来传递show, canShow, mouseEvent对象</li></ul> <p>插件在实测中遇到了一些问题（现在没有这些问题了）：</p> <ul><li>切换到别的路由，上一页面的放大图还在显示</li> <li>切换到别的路由再切换回来，放大图不能显示</li> <li>图片定时会更新一次，当图片更新时，放大图不能显示</li> <li>右键呼出自定义菜单后，再关闭，放大图不能显示</li> <li>切换路由后，在空白背景区域出现了上一页面的放大图</li></ul> <h2 id="实现"><a href="#实现" aria-hidden="true" class="header-anchor">#</a> 实现</h2> <p>实现主要分为两部分：组件用于放大图显示、install方法中用于监听鼠标事件，处理显示隐藏的逻辑。下面为install方法地注释，组件的实现比较简单，这里不作细述。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// index.js </span>
<span class="token keyword">import</span> hoverImgComponent <span class="token keyword">from</span> <span class="token string">'./index.vue'</span>

<span class="token keyword">const</span> hoverZoomImg <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">install</span> <span class="token punctuation">(</span>Vue<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ~~~省略初始化代码~~~</span>
    <span class="token keyword">let</span> contextmenuShow <span class="token operator">=</span> <span class="token boolean">false</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// click肯定操作肯定会使菜单消失，所以如果click后，放大图能显示，至于鼠标位置有没有可以显示的图片，这部分逻辑都在hoverImgComponent组件中</span>
      <span class="token comment">// 如果contextmenuShow为false，那么不需要任何操作，要么切换了路由，要么没有触发任何交互</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>contextmenuShow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          contextmenuShow <span class="token operator">=</span> <span class="token boolean">false</span>
          instance<span class="token punctuation">.</span><span class="token function">setCanShow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 菜单显示时，不显示放大图</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      contextmenuShow <span class="token operator">=</span> <span class="token boolean">true</span>
      instance<span class="token punctuation">.</span><span class="token function">setCanShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      instance<span class="token punctuation">.</span><span class="token function">setEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 随缘mixin，如果使用了vue-router的话，便可进行一顿操作，没有的话也就当是无用代码了</span>
    Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function">beforeRouteLeave</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instance<span class="token punctuation">.</span>imgSrc <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 防止跳转页面显示上个页面跳转时出现的大图</span>
        instance<span class="token punctuation">.</span>containerId <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 路由切换后需要触发容器重新计算的watch</span>
        contextmenuShow <span class="token operator">?</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// contextmenu出现时，一次click只能使contextmenu隐藏，而不是离开页面</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">function</span> <span class="token function">onMouseEnter</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      instance<span class="token punctuation">.</span><span class="token function">setEvent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
      instance<span class="token punctuation">.</span><span class="token function">setShow</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">onMouseLeave</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      instance<span class="token punctuation">.</span><span class="token function">setShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'hover-zoom-img'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function">bind</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> binding <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> containerId <span class="token punctuation">}</span> <span class="token operator">=</span> binding<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        instance<span class="token punctuation">.</span>containerId <span class="token operator">=</span> containerId
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 使用了两个标志位，canShow控制是否有权限显示（contextmenu出现时），show表示此处有可以显示的资源（img）</span>
      <span class="token function">inserted</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">,</span> onMouseEnter<span class="token punctuation">)</span>
        el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> onMouseLeave<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">unbind</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseenter'</span><span class="token punctuation">,</span> onMouseEnter<span class="token punctuation">)</span>
        el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseleave'</span><span class="token punctuation">,</span> onMouseLeave<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>show <span class="token operator">&amp;&amp;</span> instance<span class="token punctuation">.</span><span class="token function">setShow</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> hoverZoomImg
</code></pre></div><h2 id="指令的钩子函数"><a href="#指令的钩子函数" aria-hidden="true" class="header-anchor">#</a> 指令的钩子函数</h2> <p>使用指令时有五个钩子函数bind, inserted, update, componentUpdated, unbind，参照<a href="https://cn.vuejs.org/v2/guide/custom-directive.html#%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0" target="_blank" rel="noopener noreferrer">自定义指令 - 钩子函数<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://www.imys.net/20161216/vue-custom-directive-hook.html" target="_blank" rel="noopener noreferrer">正确使用Vue指令的钩子函数 - 王昱森<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>便可了解这些钩子的触发条件。</p> <p>示例代码操作如下：</p> <ol><li>加载后，点击<code>update test</code>，打印<code>update hello</code>、<code>componentUpdated hello</code></li> <li>点击<code>update</code>，打印<code>update hello</code>、<code>componentUpdated hi</code>(componentUpdated在组件及其子组件更新完毕后调用)</li> <li>点击<code>unbind</code>，打印<code>unbind</code></li> <li>点击<code>bind</code>，打印<code>bind null</code>、<code>inserted &lt;div class=&quot;wrapper&quot;&gt;...&lt;/div&gt;</code></li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{test}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>update test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-test</span><span class="token punctuation">&gt;</span></span>{{msg}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>update<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>update<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bind<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>bind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>unbind<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>unbind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>
      test<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'hi'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">unbind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> <span class="token string">'hello'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">bind</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bind'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>parentNode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">inserted</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inserted'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>parentNode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">update</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">componentUpdated</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'componentUpdated'</span><span class="token punctuation">,</span> el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">unbind</span> <span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unbind'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="区别"><a href="#区别" aria-hidden="true" class="header-anchor">#</a> 区别</h3> <h4 id="bind和inserted"><a href="#bind和inserted" aria-hidden="true" class="header-anchor">#</a> bind和inserted</h4> <ul><li><code>bind</code>时parentNode为null，<code>inserted</code>时有值，和官网描述一致。<code>bind</code>在绑定时调用，<code>inserted</code>在插入父节点时调用。</li></ul> <h4 id="update和componentupdated"><a href="#update和componentupdated" aria-hidden="true" class="header-anchor">#</a> update和componentUpdated</h4> <ul><li><code>update</code>和<code>componentUpdated</code>在整个组件有更新时即触发，所以触发次数会很多，可以通过对比vnode和oldVnode来忽略不关注的更新。</li> <li><code>update</code>时msg还是原值，<code>componentUpdated</code>时更新后的值，没毛病。</li></ul> <div class="tip custom-block"><p class="custom-block-title">TODO</p> <p>https://madewithvuejs.com/plugins</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2/28/2019, 11:17:44 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/blog/2019-02-26 post请求的content-type.html" class="prev">
          19-02-26 post请求的content-type
        </a></span> <span class="next"><a href="/blog/blog/2019-02-28 了解FLIP动画.html">
          19-02-28 了解FLIP动画
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.07784aa4.js" defer></script><script src="/blog/assets/js/2.c1200efd.js" defer></script><script src="/blog/assets/js/17.8c2b56b4.js" defer></script>
  </body>
</html>
